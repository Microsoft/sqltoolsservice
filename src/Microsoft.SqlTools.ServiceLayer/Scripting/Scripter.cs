//
// Copyright (c) Microsoft. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.
//
// THIS FILE IS GENERATED BY A CODEGEN TOOL. DO NOT EDIT!!!!
// IF YOU NEED TO MAKE CHANGES, EDIT THE .TT FILE!!!

// To regenerate either (1) save the .TT file from Visual Studio or (2) run the build script codegen task.

using System;
using System.IO;
using System.Collections.Generic;
using System.Collections.Specialized;
using Microsoft.SqlServer.Management.Smo;
using Microsoft.SqlServer.Management.SqlParser.Intellisense;
using Microsoft.SqlTools.Utility;
using Microsoft.SqlTools.ServiceLayer.Scripting.Contracts;
namespace Microsoft.SqlTools.ServiceLayer.Scripting
{
	internal partial class Scripter
    {

		private void Initialize()
        {
            AddSupportedType(DeclarationType.Table, GetTableScripts, "Table", "table");
            AddSupportedType(DeclarationType.View, GetViewScripts, "View", "view");
            AddSupportedType(DeclarationType.StoredProcedure, GetStoredProcedureScripts, "Procedure", "stored procedure");
            AddSupportedType(DeclarationType.Schema, GetSchemaScripts, "Schema", "schema");
            AddSupportedType(DeclarationType.Database, GetDatabaseScripts, "Database", "database");
            AddSupportedType(DeclarationType.UserDefinedDataType, GetUserDefinedDataTypeScripts, "Type", "user-defined data type");
            AddSupportedType(DeclarationType.UserDefinedTableType, GetUserDefinedTableTypeScripts, "Type", "user-defined table type");
            AddSupportedType(DeclarationType.Synonym, GetSynonymScripts, "Synonym", "");
            AddSupportedType(DeclarationType.ScalarValuedFunction, GetScalarValuedFunctionScripts, "Function", "scalar-valued function");
            AddSupportedType(DeclarationType.TableValuedFunction, GetTableValuedFunctionScripts, "Function", "table-valued function");
        }

        /// <summary>
        /// Script a Table using SMO
        /// </summary>
        /// <param name="objectName">Table name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetTableScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                ScriptingParams requestParams = new ScriptingParams
                {
                    FilePath = filePath,
                    ConnectionString = this.connectionInfo.OwnerUri,
                    IncludeTypes = {"Table"},
                    ScriptOptions = new ScriptOptions
                    {
                        TypeOfDataToScript = "SchemaOnly",
                        AppendToFile = true
                    },
                };
                ScriptingScriptOperation operation = new ScriptingScriptOperation(requestParams);
                operation.Execute();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetTableScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a View using SMO
        /// </summary>
        /// <param name="objectName">View name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetViewScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                View smoObject = string.IsNullOrEmpty(schemaName) ? new View(this.Database, objectName) : new View(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetViewScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a StoredProcedure using SMO
        /// </summary>
        /// <param name="objectName">StoredProcedure name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetStoredProcedureScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                StoredProcedure smoObject = string.IsNullOrEmpty(schemaName) ? new StoredProcedure(this.Database, objectName) : new StoredProcedure(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetStoredProcedureScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a Schema using SMO
        /// </summary>
        /// <param name="objectName">Schema name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetSchemaScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                Schema smoObject = new Schema(this.Database, objectName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetSchemaScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a Database using SMO
        /// </summary>
        /// <param name="objectName">Database name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetDatabaseScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                Database smoObject = new Database(new Server(this.serverConnection), objectName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetDatabaseScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a UserDefinedDataType using SMO
        /// </summary>
        /// <param name="objectName">UserDefinedDataType name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetUserDefinedDataTypeScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                UserDefinedDataType smoObject = string.IsNullOrEmpty(schemaName) ? new UserDefinedDataType(this.Database, objectName) : new UserDefinedDataType(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetUserDefinedDataTypeScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a UserDefinedTableType using SMO
        /// </summary>
        /// <param name="objectName">UserDefinedTableType name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetUserDefinedTableTypeScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                UserDefinedTableType smoObject = string.IsNullOrEmpty(schemaName) ? new UserDefinedTableType(this.Database, objectName) : new UserDefinedTableType(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetUserDefinedTableTypeScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a Synonym using SMO
        /// </summary>
        /// <param name="objectName">Synonym name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetSynonymScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                Synonym smoObject = string.IsNullOrEmpty(schemaName) ? new Synonym(this.Database, objectName) : new Synonym(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetSynonymScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a ScalarValuedFunction using SMO
        /// </summary>
        /// <param name="objectName">ScalarValuedFunction name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetScalarValuedFunctionScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                UserDefinedFunction smoObject = string.IsNullOrEmpty(schemaName) ? new UserDefinedFunction(this.Database, objectName) : new UserDefinedFunction(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetScalarValuedFunctionScripts : " + ex.Message);
                return false;
            }
        }

        /// <summary>
        /// Script a TableValuedFunction using SMO
        /// </summary>
        /// <param name="objectName">TableValuedFunction name</param>
        /// <param name="schemaName">Schema name</param>
        /// <returns>String collection of scripts</returns>
        internal bool GetTableValuedFunctionScripts(string objectName, string schemaName, string filePath)
        {
            try
            {
                UserDefinedFunction smoObject = string.IsNullOrEmpty(schemaName) ? new UserDefinedFunction(this.Database, objectName) : new UserDefinedFunction(this.Database, objectName, schemaName);
                smoObject.Refresh();
                return true;
            }
            catch (Exception ex)
            {
                Logger.Write(LogLevel.Error,"Exception at PeekDefinition GetTableValuedFunctionScripts : " + ex.Message);
                return false;
            }
        }

	}
}
	